<!DOCTYPE html>
<html>
<head>
    <title>CORS Debug Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .output { background: #f9f9f9; border: 1px solid #ddd; border-radius: 4px; padding: 15px; margin-top: 20px; white-space: pre-wrap; font-size: 12px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç CORS Debug Test</h1>
        
        <p><strong>Backend URL:</strong> http://localhost:8000</p>
        <p><strong>Frontend URL:</strong> http://localhost:3000</p>
        
        <button onclick="testCORS()">Test CORS Request</button>
        <button onclick="testHealth()">Test Health Endpoint</button>
        <button onclick="clearOutput()">Clear Output</button>
        
        <div class="output" id="output">Output will appear here...</div>
    </div>

    <script>
        function log(message, isError = false) {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const className = isError ? 'error' : 'success';
            output.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }

        function clearOutput() {
            document.getElementById('output').innerHTML = 'Output cleared...\n';
        }

        function testHealth() {
            log('Testing /health endpoint...');
            fetch('http://localhost:8000/health')
                .then(res => {
                    log(`‚úì Status: ${res.status}`);
                    log(`‚úì Headers: ${JSON.stringify(Array.from(res.headers.entries()))}`);
                    return res.json();
                })
                .then(data => log(`‚úì Response: ${JSON.stringify(data)}`))
                .catch(err => log(`‚úó Error: ${err.message}`, true));
        }

        function testCORS() {
            log('Testing /api/signup with CORS...');
            
            fetch('http://localhost:8000/api/signup', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Origin': 'http://localhost:3000'
                },
                body: JSON.stringify({
                    username: 'corstest',
                    email: 'cors@test.com',
                    password: 'testpass123'
                })
            })
            .then(res => {
                log(`‚úì Status: ${res.status} ${res.statusText}`);
                
                const corsHeader = res.headers.get('access-control-allow-origin');
                if (corsHeader) {
                    log(`‚úì CORS Header: access-control-allow-origin = ${corsHeader}`);
                } else {
                    log(`‚úó CORS Header NOT found!`, true);
                }
                
                log(`‚úì All Headers:`);
                res.headers.forEach((value, key) => {
                    log(`  ${key}: ${value}`);
                });
                
                return res.json();
            })
            .then(data => log(`‚úì Response: ${JSON.stringify(data)}`))
            .catch(err => {
                log(`‚úó Fetch Error: ${err.message}`, true);
                log(`‚úó Type: ${err.constructor.name}`, true);
            });
        }

        // Auto-test on load
        window.addEventListener('load', () => {
            log('Page loaded. Ready for testing.');
            log('Origin: ' + window.location.origin);
        });
    </script>
</body>
</html>
